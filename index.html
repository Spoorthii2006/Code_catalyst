<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🌍 EcoFinds</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>🌿 EcoFinds 🌿</h1>

  <!-- User Section -->
  <div id="user-section">
    <h2>👋 Hello <span id="username">Guest</span></h2>
    <p id="points" style="display:none;">🌱 Points: <span id="points-value">0</span></p>

    <!-- Register -->
    <div id="register-form">
      <h3>📝 Register</h3>
      <input type="text" id="reg-username" placeholder="🙋 Username">
      <input type="email" id="reg-email" placeholder="📧 Email">
      <input type="password" id="reg-password" placeholder="🔑 Password">
      <button onclick="register()">Register</button>
    </div>

    <!-- Login -->
    <div id="login-form">
      <h3>🔐 Login</h3>
      <input type="email" id="login-email" placeholder="📧 Email">
      <input type="password" id="login-password" placeholder="🔑 Password">
      <button onclick="login()">Login</button>
    </div>

    <!-- Logout -->
    <div id="logout-section" style="display:none;">
      <button onclick="logout()">👋 Logout</button>
    </div>
  </div>

  <!-- Add Product -->
  <div id="product-form" style="display:none;">
    <h3>➕ Add Product</h3>
    <input type="text" id="prod-title" placeholder="📦 Title">
    <input type="text" id="prod-category" placeholder="📂 Category">
    <input type="text" id="prod-description" placeholder="📝 Description">
    <input type="number" id="prod-price" placeholder="💲 Price" step="0.01">
    <button onclick="addProduct()">Add Product</button>
  </div>

  <!-- Product Feed -->
  <h2>🛒 Product Feed</h2>
  <ul id="product-list"></ul>

  <!-- Cart -->
  <h2>🛍️ Your Cart</h2>
  <ul id="cart-list"></ul>
  <p id="cart-total">💰 Total: $0</p>
  <button id="checkout-btn" onclick="checkout()" style="display:none;">✅ Checkout</button>

<script>
  let users = [];
  let products = [];
  let loggedInUser = null;
  let productId = 1;

  function register() {
    const username = document.getElementById("reg-username").value;
    const email = document.getElementById("reg-email").value;
    const password = document.getElementById("reg-password").value;

    if(users.some(u => u.email === email)) {
      alert("⚠️ Email already exists!");
      return;
    }

    const user = {username, email, password, points:0, cart:[]};
    users.push(user);
    loggedInUser = user;
    updateUI();
    alert("🎉 Welcome "+username+"! You are now registered.");
  }

  function login() {
    const email = document.getElementById("login-email").value;
    const password = document.getElementById("login-password").value;

    const user = users.find(u => u.email === email && u.password === password);
    if(user) {
      loggedInUser = user;
      updateUI();
      alert("💚 Welcome back "+user.username+"!");
    } else {
      alert("🚫 Wrong email or password!");
    }
  }

  function logout() {
    alert("👋 Goodbye "+loggedInUser.username+" — you leave with "+loggedInUser.points+" 🌱 points!");
    loggedInUser = null;
    updateUI();
  }

  function addProduct() {
    if(!loggedInUser) { alert("🚫 Please login first!"); return; }

    const title = document.getElementById("prod-title").value;
    const category = document.getElementById("prod-category").value;
    const description = document.getElementById("prod-description").value;
    const price = parseFloat(document.getElementById("prod-price").value);

    const product = {id: productId++, title, category, description, price, owner: loggedInUser.email};
    products.push(product);
    updateUI();
    alert("🌟 Product '"+title+"' added!");
  }

  function renderProducts() {
    const list = document.getElementById("product-list");
    list.innerHTML = "";
    products.forEach(p => {
      const li = document.createElement("li");
      li.innerHTML = `📦 ${p.title} | 📂 ${p.category} | 💲 ${p.price.toFixed(2)}
        <button onclick="addToCart(${p.id})">➕ Add to Cart</button>`;
      list.appendChild(li);
    });
  }

  function addToCart(pid) {
    if(!loggedInUser) { alert("🚫 Please login first!"); return; }

    const product = products.find(p => p.id === pid);
    if(!product) return;

    const cartItem = loggedInUser.cart.find(c => c.product.id === pid);
    if(cartItem) {
      cartItem.quantity++;
    } else {
      loggedInUser.cart.push({product, quantity:1});
    }
    updateUI();
    alert("🛒 Added "+product.title+" to cart!");
  }

  function renderCart() {
    const list = document.getElementById("cart-list");
    list.innerHTML = "";
    let total = 0;
    if(loggedInUser) {
      loggedInUser.cart.forEach(c => {
        total += c.product.price * c.quantity;
        const li = document.createElement("li");
        li.innerHTML = `${c.quantity} x ${c.product.title} - $${(c.product.price * c.quantity).toFixed(2)}`;
        list.appendChild(li);
      });
    }
    document.getElementById("cart-total").innerText = "💰 Total: $"+total.toFixed(2);
    document.getElementById("checkout-btn").style.display = (loggedInUser && loggedInUser.cart.length > 0) ? "block":"none";
  }

  function checkout() {
    if(!loggedInUser) { alert("🚫 Please login first!"); return; }
    let total = 0;
    loggedInUser.cart.forEach(c => total += c.product.price * c.quantity);
    const points = Math.floor(total/10);
    loggedInUser.points += points;
    loggedInUser.cart = [];
    updateUI();
    alert("✅ Checkout complete! You earned "+points+" 🌱 eco points!");
  }

  function updateUI() {
    document.getElementById("username").innerText = loggedInUser ? loggedInUser.username : "Guest";
    document.getElementById("points").style.display = loggedInUser ? "block" : "none";
    document.getElementById("points-value").innerText = loggedInUser ? loggedInUser.points : "0";

    document.getElementById("register-form").style.display = loggedInUser ? "none" : "block";
    document.getElementById("login-form").style.display = loggedInUser ? "none" : "block";
    document.getElementById("logout-section").style.display = loggedInUser ? "block" : "none";
    document.getElementById("product-form").style.display = loggedInUser ? "block" : "none";

    renderProducts();
    renderCart();
  }

  updateUI();
</script>
</body>
</html>